---
title: 由EggJS项目衍生的总结
tags: 
      - EggJS
      - NodeJS
      - 学习笔记
---

由EggJS项目衍生的总结
=================================

〇、背景
---------------------------

-  要对`EggJS`框架后端CRUD操作进行某些操作，需要接入同事已经封装好的 npm包。<!--more-->

一、动工
-----------------------------

- 这个时候就要先用到中间件，本来是在`ThinkJS`那边接好的，然后要由我移植到`EggJS`上，虽然`ThinkJS`与`EggJS`的中间件接入方法大同小异，但是他们对于配置传参的方法是不一样的，所以虽然大部分代码可以复用，但是也要对其进行修改。

- 在进行移植的时候，要对源代码进行修改和测试，这个时候总是会遇到许许多多的问题，这个时候就要活用`console.log()`与命令行log里的错误信息，根据他们所给的信息进行问题与错误的定位，然后去解决问题。不过后端应该有断点调试的debug方法，但是我不会用Orz，这个还需要我去学习。

- 除了修改中出现的问题，修改后才出现的bug也值得我们去注意，这个时候可以利用git的GUI工具去比对自己commit的代码，查看修改的地方，逐一排查出冲突点，然后去解决问题。

- 使用push提交代码前最好也是使用如上方法查看自己的代码，检查是否有未删去的测试代码，这次没删干净就给别人添麻烦了Orz。有一个不错的办法就是在本地新建一个debug/test分支用来测试自己开发的分支，测试完了再切回去修改上传，做到不污染主分支代码。~~导师疯狂吐槽我遗留的测试代码，甚至merge以后让她多了个bug（逃）~~

- 简单的EggJS插件的开发和修改也并没有我想象中那么困难，理解插件功能的生命周期，根据这份理解做好从中间件移植升级到插件的工作，最后再安插进框架的主体内部并配置好基本上就没问题了。不过在进行这项工作的时候也查看了部门其他插件的源码，感觉自己要熟练掌握插件的开发还有很长的路要走。

-  这次任务最大的难点在于对同事写的egg插件的生成的`Sequelize`对象进行全局钩子挂载，试了各种方法都没能成功，查看了插件的源码也看不出有什么原因，可能是我水平还不够吧，最后测试能在`Model`的`define`里能进行hooks的声明，最后只有修改该插件生成`Model`模块的语句使其在`define`的时候直接插入`sequelize`的钩子，然后把重复代码提取打包成一个工具方法，再在每一个`Model`的JS文件头部使用`require`引入，这是目前我能想到的最优雅的解决办法了。

二、结语
-----------------------------

- 不去做就不知道自己能够做成功，但是在做的时候也要注意不要钻入牛角尖，也要跳出来思考，在理解业务逻辑的基础上站在更高层面去思考，也不要麻木地没有目标地对着代码调试，要思考这个程序整条链条的逻辑，书读百遍其义自见，代码也是如此。

- 通过这次需求也是发现了自己还有很多很多不成熟、做得不规范的地方，未来在这些方面要好好地去养成良好的习惯，并且做到遵守规范，熟悉业务熟悉框架，做一个让团队省心乃至放心的人。

上传于2020-11-07